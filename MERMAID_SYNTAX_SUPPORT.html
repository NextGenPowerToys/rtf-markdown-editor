<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MERMAID_SYNTAX_SUPPORT</title>
  <style>
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  height: auto;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  background-color: #ffffff;
  color: #000000;
}

/* Content wrapper for exported HTML */
.editor-content {
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
  line-height: 1.6;
}

/* Headings */
h1, h2, h3, h4, h5, h6 {
  margin-top: 24px;
  margin-bottom: 12px;
  font-weight: 600;
}

h1 {
  font-size: 2em;
  border-bottom: 1px solid #ddd;
  padding-bottom: 0.3em;
}

h2 {
  font-size: 1.5em;
  border-bottom: 1px solid #eee;
  padding-bottom: 0.3em;
}

h3 {
  font-size: 1.25em;
}

h4 {
  font-size: 1em;
}

h5 {
  font-size: 0.875em;
}

h6 {
  font-size: 0.85em;
  color: #6a737d;
}

/* Paragraphs */
p {
  margin: 0 0 16px 0;
}

/* Links */
a {
  color: #0969da;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* Lists */
ul, ol {
  margin: 0 0 16px 0;
  padding-left: 2em;
}

li {
  margin-bottom: 4px;
}

/* Code */
code {
  background-color: #f6f8fa;
  padding: 2px 6px;
  border-radius: 3px;
  font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
  font-size: 0.875em;
}

pre {
  background-color: #f6f8fa;
  border: 1px solid #e1e4e8;
  border-radius: 6px;
  padding: 16px;
  overflow-x: auto;
  margin: 0 0 16px 0;
}

pre code {
  background-color: transparent;
  padding: 0;
  border-radius: 0;
  font-size: 0.875em;
}

/* Blockquotes */
blockquote {
  border-left: 4px solid #ddd;
  color: #6a737d;
  padding: 0 15px;
  margin: 0 0 16px 0;
}

blockquote p {
  margin: 0;
}

/* Tables */
table {
  border-collapse: collapse;
  width: 100%;
  margin: 0 0 16px 0;
}

table thead {
  background-color: #f6f8fa;
}

table th, table td {
  border: 1px solid #d0d7de;
  padding: 12px;
  text-align: left;
}

table th {
  font-weight: 600;
}

table tbody tr:nth-child(even) {
  background-color: #f6f8fa;
}

/* Images */
img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 16px 0;
  border-radius: 6px;
  border: 1px solid #d0d7de;
}

img.align-left {
  float: left;
  margin-right: 16px;
  margin-bottom: 8px;
}

img.align-center {
  margin-left: auto;
  margin-right: auto;
  display: block;
}

img.align-right {
  float: right;
  margin-left: 16px;
  margin-bottom: 8px;
}

/* Horizontal rule */
hr {
  border: none;
  border-top: 2px solid #ddd;
  margin: 24px 0;
}

/* Strong and emphasis */
strong {
  font-weight: 600;
}

em {
  font-style: italic;
}

/* Strikethrough */
del {
  text-decoration: line-through;
  color: #6a737d;
}

/* Math display */
.math-display {
  display: block;
  overflow-x: auto;
  margin: 16px 0;
  padding: 12px;
  background-color: #f6f8fa;
  border-radius: 6px;
}

.math-inline {
  display: inline;
}

/* Mermaid diagram */
[data-mdwe="mermaid"] {
  display: block;
  margin: 16px 0;
  text-align: center;
}

/* RTL Support */
html[dir="rtl"],
html[dir="RTL"] {
  direction: rtl;
  text-align: right;
}

html[dir="rtl"] h1,
html[dir="rtL"] h2,
html[dir="rtl"] h3,
html[dir="rtl"] h4,
html[dir="rtl"] h5,
html[dir="rtl"] h6 {
  text-align: right;
}

html[dir="rtl"] ul,
html[dir="rtl"] ol {
  padding-left: 0;
  padding-right: 2em;
}

html[dir="rtl"] blockquote {
  border-left: none;
  border-right: 4px solid #ddd;
  padding-left: 0;
  padding-right: 15px;
}

html[dir="rtl"] img.align-left {
  float: right;
  margin-right: 0;
  margin-left: 16px;
}

html[dir="rtl"] img.align-right {
  float: left;
  margin-left: 0;
  margin-right: 16px;
}

/* Print styles */
@media print {
  body {
    background-color: #fff;
  }
  
  .editor-content {
    padding: 0;
  }
  
  a {
    color: #0969da;
  }
  
  img {
    max-width: 100%;
  }
}

/* KaTeX CSS */
.katex { font-size: 1.21em; font-style: italic; }
.katex .katex-mathml { display: none; }
.katex .mord { position: relative; }
.katex .sizing.reset-size1.size1, .katex button.size1 { font-size: 1em; }
.katex .fontsize-ensurer { display: inline; font-size: 1em; }
.katex .mathrm { font-style: normal; }
.katex .mathit { font-style: italic; }
.katex .mathbf { font-weight: bold; }
.katex .boldsymbol { font-weight: bold; font-style: italic; }

</style>
</head>
<body>
  <div class="editor-content"><h1>Mermaid Diagram Syntax Support</h1>
<p>The RTF Markdown Editor now supports <strong>both</strong> standard Markdown and Azure DevOps Wiki syntax for Mermaid diagrams.</p>
<h2>Supported Syntax Formats</h2>
<h3>Standard Markdown (Triple Backticks)</h3>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_0">graph TD
    A[Start] --&gt; B{Decision}
    B --&gt;|Yes| C[End]</div>
<h3>Azure DevOps Wiki (Triple Colons)</h3>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_1">graph TD
    A[Start] --&gt; B{Decision}
    B --&gt;|Yes| C[End]</div>
<h2>Format Preservation</h2>
<p><strong>Important</strong>: The editor preserves the original fence format when you save the document.</p>
<ul>
<li>If you use <code>```mermaid</code>, it will be saved as <code>```mermaid</code></li>
<li>If you use <code>::: mermaid</code>, it will be saved as <code>::: mermaid</code></li>
</ul>
<p>This ensures compatibility with:</p>
<ul>
<li>GitHub Markdown (uses backticks)</li>
<li>Azure DevOps Wiki (uses colons)</li>
<li>GitLab Markdown (uses backticks)</li>
<li>Standard Markdown parsers</li>
</ul>
<h2>Implementation Details</h2>
<h3>How It Works</h3>
<ol>
<li><strong>Parsing</strong>: When opening a document, the parser detects both fence types</li>
<li><strong>Storage</strong>: Each mermaid block stores its original fence type (<code>backtick</code> or <code>colon</code>)</li>
<li><strong>Rendering</strong>: Both formats render identically in the WYSIWYG editor</li>
<li><strong>Saving</strong>: The original fence type is preserved when converting back to markdown</li>
</ol>
<h3>Technical Changes</h3>
<ul>
<li><strong>Type Definition</strong>: <code>MermaidBlock</code> interface now includes <code>fenceType</code> property</li>
<li><strong>Markdown Processor</strong>: Recognizes both <code>^```\s*mermaid</code> and <code>^:::\s*mermaid</code> patterns</li>
<li><strong>HTML Processor</strong>: Stores fence type in <code>data-fence-type</code> attribute on div elements</li>
<li><strong>Editor</strong>: Preserves <code>data-fence-type</code> attribute through edit cycles</li>
</ul>
<h2>Testing</h2>
<p>Use <a href="test_mermaid_formats.md">test_mermaid_formats.md</a> to verify:</p>
<ol>
<li>Open the test file in the RTF Markdown Editor</li>
<li>Both backtick and colon formats should render as diagrams</li>
<li>Make an edit to the document</li>
<li>Save the document</li>
<li>Verify in the raw markdown that each format is preserved</li>
</ol>
<h2>Migration Notes</h2>
<ul>
<li><strong>Existing Documents</strong>: All existing mermaid blocks will continue to work</li>
<li><strong>Default Format</strong>: New blocks created via the editor use backticks (standard format)</li>
<li><strong>Azure DevOps</strong>: Documents with <code>:::</code> syntax will preserve that format</li>
<li><strong>No Breaking Changes</strong>: The change is fully backward compatible</li>
</ul>
<h2>Examples</h2>
<h3>Mixed Format Document</h3>
<p>You can use both formats in the same document:</p>
<p>Standard format:</p>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_2">graph LR
    A --&gt; B</div>
<p>Azure DevOps format:</p>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_3">graph LR
    C --&gt; D</div>
<p>Both will render correctly and preserve their original format on save.</p>
<h2>Complex Examples</h2>
<h3>Application Architecture (Standard Markdown)</h3>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_4">graph TB
    subgraph Frontend["Frontend Layer"]
        UI["User Interface"]
        Router["Router"]
    end
    
    subgraph Services["Service Layer"]
        Auth["Authentication"]
        API["API Client"]
        Cache["Cache Manager"]
    end
    
    subgraph Backend["Backend Layer"]
        Server["Express Server"]
        DB[(Database)]
        Queue["Message Queue"]
    end
    
    UI --&gt; Router
    Router --&gt; Auth
    Router --&gt; API
    API --&gt; Cache
    Auth --&gt; Server
    Cache --&gt; Server
    Server --&gt; DB
    Server --&gt; Queue</div>
<h3>Application Architecture (Azure DevOps Wiki)</h3>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_5">graph TB
    subgraph Frontend["Frontend Layer"]
        UI["User Interface"]
        Router["Router"]
    end
    
    subgraph Services["Service Layer"]
        Auth["Authentication"]
        API["API Client"]
        Cache["Cache Manager"]
    end
    
    subgraph Backend["Backend Layer"]
        Server["Express Server"]
        DB[(Database)]
        Queue["Message Queue"]
    end
    
    UI --&gt; Router
    Router --&gt; Auth
    Router --&gt; API
    API --&gt; Cache
    Auth --&gt; Server
    Cache --&gt; Server
    Server --&gt; DB
    Server --&gt; Queue</div>
<h3>Microservices Workflow (Standard Markdown)</h3>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_6">graph TB
    subgraph Client["Client Applications"]
        Web["Web App"]
        Mobile["Mobile App"]
    end
    
    subgraph Gateway["API Gateway"]
        LB["Load Balancer"]
        Auth["OAuth2"]
    end
    
    subgraph Services["Microservices"]
        UserSvc["User Service"]
        OrderSvc["Order Service"]
        PaymentSvc["Payment Service"]
    end
    
    subgraph Data["Data Layer"]
        UserDB[(User DB)]
        OrderDB[(Order DB)]
        Cache[(Redis Cache)]
    end
    
    Web --&gt; LB
    Mobile --&gt; LB
    LB --&gt; Auth
    Auth --&gt; UserSvc
    Auth --&gt; OrderSvc
    Auth --&gt; PaymentSvc
    UserSvc --&gt; UserDB
    OrderSvc --&gt; OrderDB
    PaymentSvc --&gt; OrderDB
    UserSvc --&gt; Cache
    OrderSvc --&gt; Cache</div>
<h3>Microservices Workflow (Azure DevOps Wiki)</h3>
<div class="mermaid" data-mdwe="mermaid" data-id="MERMAID_7">graph TB
    subgraph Client["Client Applications"]
        Web["Web App"]
        Mobile["Mobile App"]
    end
    
    subgraph Gateway["API Gateway"]
        LB["Load Balancer"]
        Auth["OAuth2"]
    end
    
    subgraph Services["Microservices"]
        UserSvc["User Service"]
        OrderSvc["Order Service"]
        PaymentSvc["Payment Service"]
    end
    
    subgraph Data["Data Layer"]
        UserDB[(User DB)]
        OrderDB[(Order DB)]
        Cache[(Redis Cache)]
    end
    
    Web --&gt; LB
    Mobile --&gt; LB
    LB --&gt; Auth
    Auth --&gt; UserSvc
    Auth --&gt; OrderSvc
    Auth --&gt; PaymentSvc
    UserSvc --&gt; UserDB
    OrderSvc --&gt; OrderDB
    PaymentSvc --&gt; OrderDB
    UserSvc --&gt; Cache
    OrderSvc --&gt; Cache</div>
</div>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  if (typeof mermaid !== 'undefined') {
    mermaid.initialize({ startOnLoad: true, theme: 'default' });
    mermaid.contentLoaded();
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16/dist/katex.min.js"></script>
<script>
  if (typeof katex !== 'undefined') {
    document.querySelectorAll('.math-display, .math-inline').forEach(function(el) {
      const isDisplay = el.classList.contains('math-display');
      const content = el.textContent;
      try {
        katex.render(content, el, { displayMode: isDisplay, throwOnError: false });
      } catch (e) {
        console.warn('KaTeX rendering error:', e);
      }
    });
  }
</script>
</body>
</html>